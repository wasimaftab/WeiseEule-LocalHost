the voyager spacecraft discovered that the ice giants uranus and neptune have nondipolar magnetic fields, defying expectations that a thick interior layer of planetary ices would generate strong dipolar fields. stanley and bloxham showed that nondipolar fields emerge if the magnetic field is only generated in a thin outer layer. however, the origin and composition of this dynamo active layer has so far remained elusive. here, we show with ab initio computer simulations that a mixture of h(2)o, ch(4), and nh(3) will phase separate under the pressure-temperature condition in the interiors of uranus and neptune, forming a h(2)o-dominated fluid in the upper mantle and a ch(4)-nh(3) mixture below. we further demonstrate that with increasing pressure, the ch(4)-nh(3) mixture becomes increasingly hydrogen depleted as it assumes the state of a polymeric c-n-h fluid. since the amount of hydrogen loss increases with pressure, we propose that the c-n-h fluid forms a stably stratified layer. the magnetic fields are primarily generated in an upper layer that is h(2)o-rich, homogeneous, convective, and electrically conducting. under these assumptions, we construct ensembles of models for the interiors of uranus and neptune with the concentric maclaurin spheroid method. we demonstrate that the phase separation of the solar-type h(2)o-ch(4)-nh(3) mixture leads to models that match the observed gravity field and to layer thicknesses that are compatible with magnetic field measurements.